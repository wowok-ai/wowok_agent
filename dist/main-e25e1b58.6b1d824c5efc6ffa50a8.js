"use strict";(this.webpackChunkwowok_agent=this.webpackChunkwowok_agent||[]).push([[588],{339:(e,t,a)=>{a.d(t,{W:()=>o});var r=a(7838),s=a(9605),i=a(9869),n=a(5882);class o extends i.s{constructor(e){super(),this.data=e}async call(e){this.data?.type_parameter&&(0,r.IsValidArgType)(this.data.type_parameter)||(0,r.ERROR)(r.Errors.IsValidArgType,"demand.type_parameter");const t=[],a=[],i=this.data?.permission?.address,n=this.data?.object?.address;if(i&&(0,r.IsValidAddress)(i)){if(this.data?.object||a.push(r.PermissionIndex.demand),void 0!==this.data?.description&&n&&a.push(r.PermissionIndex.demand_description),void 0!==this.data?.time_expire&&n&&a.push(r.PermissionIndex.demand_expand_time),void 0!==this.data?.guard&&a.push(r.PermissionIndex.demand_guard),"reward"===this.data?.bounty?.op&&a.push(r.PermissionIndex.demand_yes),"refund"===this.data?.bounty?.op&&a.push(r.PermissionIndex.demand_refund),void 0!==this.data?.present?.guard)if((0,r.IsValidAddress)(this.data.present.guard))t.push(this.data.present.guard);else if(n){const e=await(0,s.w$)({objects:[n],showContent:!0});if(e?.objects&&"Demand"===e?.objects[0]?.type){const a=e?.objects[0];a?.guard&&t.push(a?.guard.object)}}else this.data?.guard?.address&&(0,r.IsValidAddress)(this.data?.guard.address)&&t.push(this.data.guard.address);return await this.check_permission_and_call(i,a,t,!1,void 0,e)}return await this.exec(e)}async operate(e,t,a){let s,i;const o=this.data?.permission?.address,d=this.data?.object?.address;if(d)(0,r.IsValidAddress)(d)&&this.data.type_parameter&&this.data.permission&&(0,r.IsValidAddress)(o)?s=r.Demand.From(e,this.data.type_parameter,o,d):(0,r.ERROR)(r.Errors.InvalidParam,"object or permission address invalid.");else{if(!o||!(0,r.IsValidAddress)(o)){const t=this.data?.permission?.description??"";i=r.Permission.New(e,t)}s=void 0!==this.data.time_expire?r.Demand.New(e,this.data.type_parameter,"duration"===this.data.time_expire?.op,"duration"===this.data.time_expire?.op?this.data.time_expire.minutes:this.data.time_expire?.time,i?i.get_object():o,this.data?.description??"",i?void 0:t):r.Demand.New(e,this.data.type_parameter,!0,43200,i?i.get_object():o,this.data?.description??"",i?void 0:t)}if(s){const o=i?void 0:t;if(void 0!==this.data?.description&&d&&s?.set_description(this.data.description,o),void 0!==this.data?.time_expire&&d&&s?.expand_time("duration"===this.data.time_expire.op,"duration"===this.data.time_expire.op?this.data.time_expire.minutes:this.data.time_expire.time,o),void 0!==this.data?.bounty)if("add"===this.data.bounty.op){if((0,r.IsValidAddress)(this.data.bounty.object?.address))s.deposit(this.data.bounty.object?.address);else if(void 0!==this.data.bounty.object?.balance){(0,r.IsValidCoinType)(this.data.type_parameter)||(0,r.ERROR)(r.Errors.IsValidCoinType,"demand bounty");const t=await n.g.Instance().get_coin_object(e,this.data.bounty.object?.balance,a,this.data.type_parameter);t&&s.deposit(t)}}else"reward"===this.data.bounty.op?s?.yes(this.data.bounty.service,o):"refund"===this.data.bounty.op&&s?.refund(o);void 0!==this.data?.present&&s?.present(this.data.present.service,this.data.present.service_pay_type,this.data.present.recommend_words,o),void 0!==this.data?.guard&&s?.set_guard(this.data.guard.address,this.data.guard?.service_id_in_guard??void 0,o),i&&await this.new_with_mark(e,i.launch(),this.data?.permission?.namedNew,a),this.data.object||await this.new_with_mark(e,s.launch(),this.data?.object?.namedNew,a)}}}},603:(e,t,a)=>{a.d(t,{HL:()=>i,WB:()=>n,a1:()=>o,c7:()=>c,iN:()=>r,z7:()=>d});var r,s=a(7838);class i{constructor(e){this.expire=e}expire_time(){return this.expire}}!function(e){e.object="OBJECT",e.personal="PERSONAL",e.table="TABLE"}(r||(r={}));const n=(e,t)=>e+s.Protocol.Instance().package("wowok_origin")+t+"-V2";class o extends i{constructor(e=1e4){super(e),this.data=new Map}load(e){return this.data.get(e)}save(e,t){this.data.set(e,t)}remove(e){this.data.delete(e)}}class d extends i{constructor(e=1e4){super(e)}load(e){return localStorage.getItem(e)}save(e,t){return localStorage.setItem(e,t)}remove(e){return localStorage.removeItem(e)}}class c{constructor(){this.cache=new Map}static Instance(){return c._instance||(c._instance=new c),c._instance}set(e,t){this.cache.set(e,t)}get(e){return this.cache.get(e)}}},2383:(e,t,a)=>{a.d(t,{k:()=>o});var r=a(7838),s=a(9605),i=a(9869),n=a(5882);class o extends i.s{constructor(e){super(),this.data=e}async call(e){this.data?.type_parameter&&(0,r.IsValidArgType)(this.data.type_parameter)||(0,r.ERROR)(r.Errors.IsValidArgType,"arbitration.type_parameter");const t=[],a=[];var i;const n=this.data?.permission?.address,o=this.data?.object?.address,d=this.data?.fee_treasury?.address;if(n&&(0,r.IsValidAddress)(n)){if(this.data?.object||a.push(r.PermissionIndex.arbitration),void 0!==this.data?.description&&o&&a.push(r.PermissionIndex.arbitration_description),void 0!==this.data?.bPaused&&a.push(r.PermissionIndex.arbitration_pause),null==this.data?.endpoint&&a.push(r.PermissionIndex.arbitration_endpoint),void 0!==this.data?.fee&&o&&a.push(r.PermissionIndex.arbitration_fee),void 0!==d&&o&&a.push(r.PermissionIndex.arbitration_treasury),void 0!==this.data?.guard&&a.push(r.PermissionIndex.arbitration_guard),void 0!==this.data?.voting_guard&&a.push(r.PermissionIndex.arbitration_voting_guard),void 0!==this.data?.arb_arbitration&&a.push(r.PermissionIndex.arbitration_arbitration),void 0!==this.data?.arb_new?.guard)if((0,r.IsValidAddress)(this.data.arb_new.guard))t.push(this.data.arb_new.guard);else if(o){if(!i){const e=await(0,s.w$)({objects:[o],showContent:!0});e?.objects&&"Arbitration"===e.objects[0].type&&(i=e.objects[0])}i?.usage_guard&&t.push(i.usage_guard)}else this.data?.guard&&(0,r.IsValidAddress)(this.data?.guard)&&t.push(this.data.guard);return void 0!==this.data?.arb_vote&&a.push(r.PermissionIndex.treasury_receive),"string"==typeof this.data?.arb_vote?.voting_guard&&(0,r.IsValidAddress)(this.data?.arb_vote?.voting_guard)&&t.push(this.data?.arb_vote?.voting_guard),await this.check_permission_and_call(n,a,t,!1,void 0,e)}return await this.exec(e)}async operate(e,t,a){let s,i,o;const d=this.data?.permission?.address,c=this.data?.object?.address,u=this.data?.fee_treasury?.address;if(c)(0,r.IsValidAddress)(c)&&this.data.type_parameter&&d?s=r.Arbitration.From(e,this.data.type_parameter,d,c):(0,r.ERROR)(r.Errors.InvalidParam,"object or permission address invalid.");else{if(!d||!(0,r.IsValidAddress)(d)){const t=this.data?.permission?.description??"";i=r.Permission.New(e,t)}if(!u||!(0,r.IsValidAddress)(u)){const a=this.data?.fee_treasury?.description??"";o=r.Treasury.New(e,this.data?.type_parameter,i?i.get_object():d,a,i?void 0:t)}s=r.Arbitration.New(e,this.data.type_parameter,i?i.get_object():d,this.data?.description??"",BigInt(this.data?.fee??0),o?o.get_object():u,i?void 0:t)}if(s){const d=i?void 0:t;var h;if(void 0!==this.data?.description&&c&&s?.set_description(this.data.description,d),void 0!==this.data?.endpoint&&s?.set_endpoint(this.data.endpoint,d),void 0!==this.data?.fee&&c&&s?.set_fee(BigInt(this.data.fee),d),void 0!==u&&c&&s?.set_withdrawTreasury(u,d),void 0!==this.data?.arb_new){const t=BigInt(this.data.arb_new.data.fee),r=this.data?.arb_new.data;h=s?.arb({order:r.order,order_token_type:r.order_token_type,description:r.description,votable_proposition:r.votable_proposition,fee:t>BigInt(0)?await n.g.Instance().get_coin_object(e,t,a,this.data.type_parameter):void 0},d)}if(void 0!==this.data?.arb_arbitration){const e=this.data.arb_arbitration.arb??h;e||(0,r.ERROR)(r.Errors.Fail,"arb invalid: arb_arbitration"),s?.arbitration({arb:e,feedback:this.data.arb_arbitration.feedback,indemnity:this.data.arb_arbitration.indemnity},d)}if(void 0!==this.data?.arb_vote){const e=this.data.arb_vote.arb??h;e||(0,r.ERROR)(r.Errors.Fail,"arb invalid: arb_vote"),s?.vote({arb:e,voting_guard:this.data.arb_vote.voting_guard,agrees:this.data.arb_vote.agrees},d)}if(void 0!==this.data?.arb_withdraw_fee){const e=this.data.arb_withdraw_fee.arb??h;e||(0,r.ERROR)(r.Errors.Fail,"arb invalid: arb_withdraw_fee"),s?.withdraw_fee(e,this.data.arb_withdraw_fee.data,d)}if(h&&await this.new_with_mark(e,s?.arb_launch(h),this.data?.arb_new?.namedNew,a),void 0!==this.data?.voting_guard)switch(this.data.voting_guard.op){case"add":s?.add_voting_guard(this.data.voting_guard.data,d);break;case"remove":s?.remove_voting_guard(this.data.voting_guard.guards,!1,d);break;case"set":s?.remove_voting_guard([],!0,d),s?.add_voting_guard(this.data.voting_guard.data,d);break;case"removeall":s?.remove_voting_guard([],!0,d)}void 0!==this.data.guard&&s?.set_guard(this.data.guard,d),void 0!==this.data?.bPaused&&s?.pause(this.data.bPaused,d),o&&await this.new_with_mark(e,o.launch(),this.data?.fee_treasury?.namedNew,a),i&&await this.new_with_mark(e,i.launch(),this.data?.permission?.namedNew,a),c||await this.new_with_mark(e,s.launch(),this.data?.object?.namedNew,a)}}}},2429:(e,t,a)=>{a.d(t,{H9:()=>y,JD:()=>P,Jj:()=>I,Tn:()=>f,U1:()=>l,Um:()=>O,_H:()=>g,bi:()=>Y,cW:()=>E,cm:()=>w,h3:()=>S,ho:()=>R,nd:()=>v,os:()=>b,q0:()=>m,q_:()=>_,rL:()=>V,ti:()=>T,vF:()=>j,wi:()=>N});var r=a(2383),s=a(339),i=a(8947),n=a(7647),o=a(7340),d=a(7832),c=a(3605),u=a(9201),h=a(7555),p=a(4745);const l=async e=>{try{const t=JSON.parse(e);return JSON.stringify({data:await T(t)})}catch(e){return JSON.stringify({error:e?.toString()})}},_=async e=>{try{const t=JSON.parse(e);return JSON.stringify({data:await R(t)})}catch(e){return JSON.stringify({error:e?.toString()})}},g=async e=>{try{const t=JSON.parse(e);return JSON.stringify({data:await S(t)})}catch(e){return JSON.stringify({error:e?.toString()})}},y=async e=>{try{const t=JSON.parse(e);return JSON.stringify({data:await O(t)})}catch(e){return JSON.stringify({error:e?.toString()})}},m=async e=>{try{const t=JSON.parse(e);return JSON.stringify({data:await j(t)})}catch(e){return JSON.stringify({error:e?.toString()})}},f=async e=>{try{const t=JSON.parse(e);return JSON.stringify({data:await V(t)})}catch(e){return JSON.stringify({error:e?.toString()})}},E=async e=>{try{const t=JSON.parse(e);return JSON.stringify({data:await I(t)})}catch(e){return JSON.stringify({error:e?.toString()})}},b=async e=>{try{const t=JSON.parse(e);return JSON.stringify({data:await Y(t)})}catch(e){return JSON.stringify({error:e?.toString()})}},v=async e=>{try{const t=JSON.parse(e);return JSON.stringify({data:await N(t)})}catch(e){return JSON.stringify({error:e?.toString()})}},w=async e=>{try{const t=JSON.parse(e);return JSON.stringify({data:await P(t)})}catch(e){return JSON.stringify({error:e?.toString()})}},T=async e=>{const t=new s.W(e.data);return x(t,e.account,e.witness)},R=async e=>{const t=new c.U(e.data);return x(t,e.account,e.witness)},I=async e=>{const t=new u.c(e.data);return x(t,e.account,e.witness)},O=async e=>{const t=new d.t(e.data);return x(t,e.account,e.witness)},P=async e=>{const t=new h.g(e.data);return x(t,e.account,e.witness)},S=async e=>{const t=new i.g(e.data);return x(t,e.account,e.witness)},N=async e=>{const t=new o.R(e.data);return x(t,e.account,e.witness)},j=async e=>{const t=new n.Q(e.data);return x(t,e.account,e.witness)},V=async e=>{const t=new p.H(e.data);return x(t,e.account,e.witness)},Y=async e=>{const t=new r.k(e.data);return x(t,e.account,e.witness)},x=async(e,t,a)=>a?e.call_with_witness(a,t):e.call(t)},5882:(e,t,a)=>{a.d(t,{g:()=>n});var r=a(7838);const s="wowok.acc.dat",i="wowok-acc-v1";class n{constructor(e="File"){this.storage="File",this.balance=async(e,t)=>{const a=await this.get_address(e);if(a)return await r.Protocol.Client().getBalance({owner:a,coinType:t})},this.coin=async(e,t)=>{const a=await this.get_address(e);if(a)return(await r.Protocol.Client().getCoins({owner:a,coinType:t})).data},this.get_coin_object=async(e,t,a,s)=>{const i=await this.get_address(a),n=BigInt(t);if(i&&n>BigInt(0)){if(s&&"0x2::sui::SUI"!==s&&"0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI"!==s){const t=await r.Protocol.Client().getCoins({owner:i,coinType:s}),a=[];var o=BigInt(0);for(let e=0;e<t.data.length&&(o+=BigInt(t.data[e].balance),a.push(t.data[e].coinObjectId),!(o>=n));++e);if(1===a.length)return e.splitCoins(a[0],[n]);{const t=a.pop();return e.mergeCoins(t,a),e.splitCoins(t,[n])}}return e.splitCoins(e.gas,[n])}},this.coin_with_balance=async(e,t,a)=>{const s=await this.get_pair(t,!0);s||(0,r.ERROR)(r.Errors.Fail,"account invalid");const i=new r.TransactionBlock,o=await n.Instance().get_coin_object(i,e,t,a);if(o){i.transferObjects([o],s?.toSuiAddress());const e=await r.Protocol.Client().signAndExecuteTransaction({transaction:i,signer:s,options:{showObjectChanges:!0}}),t=a??"0x2::sui::SUI";return e?.objectChanges.find((e=>"created"===e?.type&&(e?.objectType).includes(t)))?.objectId}},this.storage=e}static Instance(){return n._instance||(n._instance=new n),n._instance}_add(e,t,a){var s,i="0x"+(0,r.toHEX)((0,r.decodeSuiPrivateKey)(r.Ed25519Keypair.generate().getSecretKey()).secretKey);try{if(e&&(s=JSON.parse(e))){const e=s.find((e=>e.name===t));return e?e.default=a:(a&&s.forEach((e=>e.default=!1)),s.push({name:t,key:i,default:a})),s}}catch(e){}return[{name:t,key:i,default:a}]}_default(e){var t;try{if(e&&(t=JSON.parse(e))){const e=t.find((e=>e.default));if(e)return e}}catch(e){}}_get(e,t,a){var r;try{if(e&&(r=JSON.parse(e))){const e=r.find((e=>e.name===t));if(e)return e;if(a)return r.find((e=>e.default))}}catch(e){}}_rename(e,t,a,r=!0){var s;try{if(e&&(s=JSON.parse(e)),s){const e=s.find((e=>e.name===t));if(!e)return;const i=s.find((e=>e.name===a));if(!i)return e.name=a,s;if(r)return e.name=a,i.name=t,s}}catch(e){}}set_storage(e="File"){this.storage=e}async gen(e,t){try{if("File"===this.storage){const[r,i,n]=await Promise.all([a.e(734).then(a.t.bind(a,1734,19)),a.e(734).then(a.t.bind(a,1734,19)),a.e(734).then(a.t.bind(a,1734,19))]),o=n.join(i.homedir(),s);r.readFile(o,"utf-8",((a,s)=>{const i=this._add(s,e,t);r.writeFileSync(o,JSON.stringify(i),"utf-8")}))}else if("Explorer"===this.storage){const a=this._add(localStorage.getItem(i),e,t);localStorage.setItem(i,JSON.stringify(a))}}catch(e){}}async default(){try{if("File"===this.storage){const[e,t,r]=await Promise.all([a.e(734).then(a.t.bind(a,1734,19)),a.e(734).then(a.t.bind(a,1734,19)),a.e(734).then(a.t.bind(a,1734,19))]),i=r.join(t.homedir(),s);return this._default(e.readFileSync(i,"utf-8"))}if("Explorer"===this.storage)return this._default(localStorage.getItem(i))}catch(e){}}async get(e,t=!0){try{if("File"===this.storage){const[r,i,n]=await Promise.all([a.e(734).then(a.t.bind(a,1734,19)),a.e(734).then(a.t.bind(a,1734,19)),a.e(734).then(a.t.bind(a,1734,19))]),o=n.join(i.homedir(),s);return this._get(r.readFileSync(o,"utf-8"),e,t)}if("Explorer"===this.storage)return this._get(localStorage.getItem(i),e,t)}catch(e){}}async rename(e,t,r=!0){var n;try{if("File"===this.storage){const[i,o,d]=await Promise.all([a.e(734).then(a.t.bind(a,1734,19)),a.e(734).then(a.t.bind(a,1734,19)),a.e(734).then(a.t.bind(a,1734,19))]),c=d.join(o.homedir(),s);(n=this._rename(i.readFileSync(c,"utf-8"),e,t,r))&&i.writeFileSync(c,JSON.stringify(n),"utf-8")}else"Explorer"===this.storage&&(n=this._rename(localStorage.getItem(i),e,t,r))&&localStorage.setItem(i,JSON.stringify(n))}catch(e){}return!!n}async get_address(e,t=!0){const a=await this.get(e,t);if(a)return r.Ed25519Keypair.fromSecretKey((0,r.fromHEX)(a.key)).getPublicKey().toSuiAddress()}async get_pubkey(e,t=!0){const a=await this.get(e,t);if(a)return r.Ed25519Keypair.fromSecretKey((0,r.fromHEX)(a.key)).getPublicKey().toSuiPublicKey()}async get_pair(e,t=!0){const a=await this.get(e,t);if(a)return r.Ed25519Keypair.fromSecretKey((0,r.fromHEX)(a.key))}async list(){try{if("File"===this.storage){const[e,t,i]=await Promise.all([a.e(734).then(a.t.bind(a,1734,19)),a.e(734).then(a.t.bind(a,1734,19)),a.e(734).then(a.t.bind(a,1734,19))]),n=i.join(t.homedir(),s);return JSON.parse(e.readFileSync(n,"utf-8")).map((e=>({name:e.name,default:e?.default,address:r.Ed25519Keypair.fromSecretKey((0,r.fromHEX)(e.key)).getPublicKey().toSuiAddress()})))}if("Explorer"===this.storage)return JSON.parse(localStorage.getItem(i)??"").map((e=>({name:e.name,default:e?.default,address:r.Ed25519Keypair.fromSecretKey((0,r.fromHEX)(e.key)).getPublicKey().toSuiAddress()})))}catch(e){}return[]}async faucet(e){const t=await this.get_address(e,!0);t&&await(0,r.requestSuiFromFaucetV0)({host:(0,r.getFaucetHost)("testnet"),recipient:t}).catch((e=>{}))}}},7555:(e,t,a)=>{a.d(t,{g:()=>i});var r=a(7838),s=a(9869);class i extends s.s{constructor(e){super(),this.data=e}async call(e){return await this.exec(e)}async operate(e,t,a){this.data?.root||(0,r.ERROR)(r.Errors.InvalidParam,"guard root node invalid"),this.data?.description&&!(0,r.IsValidDesription)(this.data?.description)&&(0,r.ERROR)(r.Errors.IsValidDesription,"build_guard - "+this.data.description),this.data?.table?.forEach((e=>{(!(0,r.IsValidU8)(e.identifier)||e.identifier<1)&&(0,r.ERROR)(r.Errors.InvalidParam,"table.identifer invalid"),e.bWitness||void 0!==e.value||(0,r.ERROR)(r.Errors.InvalidParam,"table.value")})),this.data?.table&&(0,r.hasDuplicates)(this.data?.table?.map((e=>e.identifier)))&&(0,r.ERROR)(r.Errors.InvalidParam,"table.identifer duplicates");var s=[];n(this.data.root,r.ValueType.TYPE_BOOL,this.data?.table??[],s);const i=(0,r.concatenate)(Uint8Array,...s),o=e.moveCall({target:r.Protocol.Instance().guardFn("new"),arguments:[e.pure.string(this.data.description??""),e.pure.vector("u8",[].slice.call(i.reverse()))]});this.data?.table?.forEach((t=>{if(t.bWitness){const a=new Uint8Array(1);a.set([t.value_type],0),e.moveCall({target:r.Protocol.Instance().guardFn("constant_add"),arguments:[e.object(o),e.pure.u8(t.identifier),e.pure.bool(!0),e.pure.vector("u8",[].slice.call(a)),e.pure.bool(!1)]})}else{const a=Uint8Array.from(r.Bcs.getInstance().ser(t.value_type,t.value)),s=(0,r.insertAtHead)(a,t.value_type);e.moveCall({target:r.Protocol.Instance().guardFn("constant_add"),arguments:[e.object(o),e.pure.u8(t.identifier),e.pure.bool(!1),e.pure.vector("u8",[].slice.call(s)),e.pure.bool(!1)]})}}));const d=e.moveCall({target:r.Protocol.Instance().guardFn("create"),arguments:[e.object(o)]});await this.new_with_mark(e,d,this.data?.namedNew,a)}}const n=(e,t,a,s)=>{const i=e;if(void 0!==i?.identifier){const e=a.find((e=>e.identifier===i.identifier));e?(o(e.value_type,t,i),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,r.ContextType.TYPE_CONSTANT)),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.identifier))):(0,r.ERROR)(r.Errors.InvalidParam,"node identifier - "+JSON.stringify(i))}else if(void 0!==i?.query){var d;if("string"==typeof i.query?d=r.GUARD_QUERIES.find((e=>e.query_name===i.query)):"number"==typeof i.query&&(d=r.GUARD_QUERIES.find((e=>e.query_id===i.query))),d||(0,r.ERROR)(r.Errors.InvalidParam,"query invalid - "+i?.query),o(d.return,t,i),d.parameters.length===i.parameters.length)for(let e=i.parameters.length-1;e>=0;--e)n(i.parameters[e],d.parameters[e],a,s);else(0,r.ERROR)(r.Errors.InvalidParam,"node query parameters length not match - "+JSON.stringify(i));if(s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,r.OperatorType.TYPE_QUERY)),"string"==typeof i.object)(0,r.IsValidAddress)(i.object)||(0,r.ERROR)(r.Errors.InvalidParam,"node object from address string - "+JSON.stringify(i)),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,r.ValueType.TYPE_ADDRESS)),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_ADDRESS,i.object));else{const e=a.find((e=>e.identifier===i.object));e?(o(e.value_type,r.ValueType.TYPE_ADDRESS,i),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,r.ContextType.TYPE_CONSTANT)),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.object))):(0,r.ERROR)(r.Errors.InvalidParam,"node object from identifier - "+JSON.stringify(i))}s.push(r.Bcs.getInstance().ser("u16",d.query_id))}else if(void 0!==i?.logic)switch(o(r.ValueType.TYPE_BOOL,t,i),i?.logic){case r.OperatorType.TYPE_LOGIC_AND:case r.OperatorType.TYPE_LOGIC_OR:i.parameters.length<2&&(0,r.ERROR)(r.Errors.InvalidParam,"node logic parameters length must >= 2"+JSON.stringify(i)),i.parameters.reverse().forEach((e=>n(e,r.ValueType.TYPE_BOOL,a,s))),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.logic)),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.parameters.length));break;case r.OperatorType.TYPE_LOGIC_NOT:1!==i.parameters.length&&(0,r.ERROR)(r.Errors.InvalidParam,"node logic parameters length must be 1"+JSON.stringify(i)),i.parameters.reverse().forEach((e=>n(e,r.ValueType.TYPE_BOOL,a,s))),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.logic));break;case r.OperatorType.TYPE_LOGIC_AS_U256_GREATER:case r.OperatorType.TYPE_LOGIC_AS_U256_GREATER_EQUAL:case r.OperatorType.TYPE_LOGIC_AS_U256_LESSER:case r.OperatorType.TYPE_LOGIC_AS_U256_LESSER_EQUAL:case r.OperatorType.TYPE_LOGIC_AS_U256_EQUAL:i.parameters.length<2&&(0,r.ERROR)(r.Errors.InvalidParam,"node logic parameters length must >= 2"+JSON.stringify(i)),i.parameters.reverse().forEach((e=>n(e,"number",a,s))),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.logic)),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.parameters.length));break;case r.OperatorType.TYPE_LOGIC_EQUAL:i.parameters.length<2&&(0,r.ERROR)(r.Errors.InvalidParam,"node logic parameters length must >= 2"+JSON.stringify(i)),i.parameters.reverse().forEach((e=>n(e,"variable",a,s))),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.logic)),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.parameters.length));break;case r.OperatorType.TYPE_LOGIC_HAS_SUBSTRING:i.parameters.length<2&&(0,r.ERROR)(r.Errors.InvalidParam,"node logic parameters length must >= 2"+JSON.stringify(i)),i.parameters.reverse().forEach((e=>n(e,r.ValueType.TYPE_STRING,a,s))),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.logic)),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.parameters.length))}else if(void 0!==i?.calc)i?.calc===r.OperatorType.TYPE_NUMBER_ADDRESS?(o(r.ValueType.TYPE_ADDRESS,t,i),1!==i.parameters.length&&(0,r.ERROR)(r.Errors.InvalidParam,"node TYPE_NUMBER_ADDRESS parameters length must == 1"+JSON.stringify(i)),i.parameters.reverse().forEach((e=>n(e,"number",a,s))),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.calc))):(o(r.ValueType.TYPE_U256,t,i),i.parameters.length<2&&(0,r.ERROR)(r.Errors.InvalidParam,"node calc parameters length must >= 2"+JSON.stringify(i)),i.parameters.reverse().forEach((e=>n(e,"number",a,s))),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.calc)),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.parameters.length)));else if(void 0!==i?.value_type)o(i?.value_type,t,i),void 0===i?.value&&(0,r.ERROR)(r.Errors.InvalidParam,"node value undefined - "+JSON.stringify(i)),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.value_type)),i.value_type==r.ValueType.TYPE_STRING||i.value_type===r.ValueType.TYPE_VEC_U8?"string"==typeof i.value?s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_STRING,i.value)):s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_VEC_U8,i.value)):s.push(r.Bcs.getInstance().ser(i?.value_type,i.value));else if(void 0!==i?.context)switch(s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.context)),i.context){case r.ContextType.TYPE_CLOCK:o(r.ValueType.TYPE_U64,t,i);break;case r.ContextType.TYPE_GUARD:case r.ContextType.TYPE_SIGNER:o(r.ValueType.TYPE_ADDRESS,t,i)}else if(void 0!==i?.identifier){(0,r.IsValidGuardIdentifier)(i.identifier)||(0,r.ERROR)(r.Errors.IsValidGuardIdentifier,"node - "+JSON.stringify(i));const e=a.find((e=>e.identifier===i.identifier));e||(0,r.ERROR)(r.Errors.InvalidParam,"identifier not found. node - "+JSON.stringify(i)),o(e.value_type,t,i),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,r.ContextType.TYPE_CONSTANT)),s.push(r.Bcs.getInstance().ser(r.ValueType.TYPE_U8,i.identifier))}else(0,r.ERROR)(r.Errors.InvalidParam,"node - "+JSON.stringify(i))},o=(e,t,a)=>{if("variable"===t)t=e;else if("number"===t){if(e===r.ValueType.TYPE_U128||e===r.ValueType.TYPE_U256||e===r.ValueType.TYPE_U8||e===r.ValueType.TYPE_U64||e===r.ContextType.TYPE_CLOCK)return}else if(t===r.ValueType.TYPE_ADDRESS&&(e===r.ContextType.TYPE_SIGNER||e===r.ContextType.TYPE_GUARD))return;if(e!==t){var s="";a&&(s=" - "+JSON.stringify(a)),(0,r.ERROR)(r.Errors.InvalidParam,"checkType: "+e+" require type: "+t+s)}}},9869:(e,t,a)=>{a.d(t,{$:()=>o,s:()=>d});var r=a(7838),s=a(3170),i=a(5882),n=a(9605);function o(e){const t=[];return e?.objectChanges?.forEach((e=>{const a=e?.objectType,r=(0,n.lS)(a);r&&t.push({type:r,type_raw:a,object:e?.objectId,version:e?.version,owner:e?.owner,change:e.type})})),t}class d{async operate(e,t,a){}constructor(){}async call(e){}async call_with_witness(e,t){if(e.guard.length>0){const a=await r.GuardParser.Create([...e.guard]);if(a){const s=await a.done(e.witness);if(s){const e=new r.TransactionBlock,a=new r.Passport(e,s);return await this.operate(e,a?.get_object(),t),a.destroy(),await this.sign_and_commit(e,t)}}else(0,r.ERROR)(r.Errors.Fail,"guard verify")}}async check_permission_and_call(e,t,a,n,o,d){var c=[];if(t.length>0||n){const a=await i.g.Instance().get_address(d);a||(0,r.ERROR)(r.Errors.InvalidParam,"check_permission_and_call: account invalid");const u=await(0,s.l)({permission_object:e,address:a});n&&!u.owner&&(0,r.ERROR)(r.Errors.noPermission,"owner"),o&&!u.admin&&(0,r.ERROR)(r.Errors.noPermission,"admin"),t.forEach((e=>{const t=r.Permission.HasPermission(u,e);t?.has||(0,r.ERROR)(r.Errors.noPermission,e),t?.guard&&c.push(t.guard)}))}if(a.length>0&&(c=c.concat(a)),c.length>0){const e=await r.GuardParser.Create([...c]),t=e?e.future_fills():[];if(e||(0,r.ERROR)(r.Errors.Fail,"guard parse"),e&&0===t.length){const t=await e.done();if(t){const e=new r.TransactionBlock,a=new r.Passport(e,t);return await this.operate(e,a?.get_object(),d),a.destroy(),await this.sign_and_commit(e,d)}}return{guard:[...c],witness:e.future_fills()}}return await this.exec()}async exec(e){const t=new r.TransactionBlock;return await this.operate(t,void 0,e),await this.sign_and_commit(t,e)}async new_with_mark(e,t,a,s,o=[r.TagName.Launch]){const d=a?.tags?(0,r.array_unique)([...a.tags,...o]):(0,r.array_unique)([...o]);if(this.resouceObject)r.Resource.From(e,this.resouceObject).add(t,d,a?.name);else{const o=await i.g.Instance().get_address(s);if(o){const s=await(0,n.h$)({address:o});s?.mark_object?r.Resource.From(e,s.mark_object).add(t,d,a?.name):(this.resouceObject=r.Entity.From(e).create_resource2(),r.Resource.From(e,this.resouceObject).add(t,d,a?.name))}else(0,r.ERROR)(r.Errors.InvalidParam,"account - "+s)}}async sign_and_commit(e,t){const a=await i.g.Instance().get_pair(t,!0);return a||(0,r.ERROR)(r.Errors.Fail,"account invalid"),this.resouceObject&&(r.Resource.From(e,this.resouceObject).launch(),this.resouceObject=void 0),await r.Protocol.Client().signAndExecuteTransaction({transaction:e,signer:a,options:{showObjectChanges:!0}})}}}}]);