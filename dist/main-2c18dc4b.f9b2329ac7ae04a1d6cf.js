"use strict";(this.webpackChunkwowok_agent=this.webpackChunkwowok_agent||[]).push([[774],{3359:(e,t,r)=>{r.d(t,{t:()=>_,v:()=>c});var i,s=r(5260),a=r(7745),n=r(9880),o=r(572),d=r(3276);class c{constructor(e){this.guard_list=[],this.guardlist=()=>this.guard_list,this.future_fills=()=>{const e=[];return this.guard_list.forEach((t=>{t.constant.filter((e=>e.bWitness)).forEach((r=>{const i=t.input.filter((e=>e.identifier===r.identifier&&void 0!==e.cmd)).map((e=>e.cmd));let s=0;t.input.forEach((e=>{e.identifier===r.identifier&&s++})),e.push({guard:t.id,witness:void 0,identifier:r.identifier,type:r.type,cmd:i??[],cited:s})}))})),e},this.done=async(e,t)=>{let r=[];if(this.guard_list.forEach((t=>{t.constant.forEach((t=>{if(t.bWitness){const r=e?.find((e=>e.identifier===t.identifier));r?t.value=r.witness:(0,o.f)(o.I.Fail,"done: invalid witness "+t.identifier)}})),t.input.filter((e=>void 0!==e.cmd)).forEach((e=>{if(void 0!==e.identifier){const i=t.constant.find((t=>t.identifier===e.identifier&&t.type===a.eV.TYPE_ADDRESS));i&&(0,n.jE)(i.value)||(0,o.f)(o.I.Fail,"done: invalid identifier "+e.identifier),r.push(i.value)}else r.push(e.value)}))})),t)return 0===r.length?void t(this.done_helper([])):void a.Zs.Instance().query_raw((0,n.SI)(r),{showType:!0}).then((e=>{t(this.done_helper(e))})).catch((e=>{console.log(e),t(void 0)}));{let e=[];return r.length>0&&(e=await a.Zs.Instance().query_raw((0,n.SI)(r),{showType:!0})),this.done_helper(e)}},this.object_query=(e,t="guard_query")=>{for(let r=0;r<a.Zs.Instance().WOWOK_OBJECTS_TYPE().length;r++)if(e.type.includes(a.Zs.Instance().WOWOK_OBJECTS_TYPE()[r]))return{target:a.Zs.Instance().WOWOK_OBJECTS_PREFIX_TYPE()[r]+t,object:s.G.SharedObjectRef({objectId:e.objectId,mutable:!1,initialSharedVersion:e.version}),types:(0,n.Lw)(e.type),id:e.objectId}},this.guards=e}static Parse_Guard_Helper(e,t){const r=a.Zs.Instance(),s=new i(e);return t.forEach((e=>{const t=e.data?.content;if(t||(0,o.f)(o.I.Fail,"Parse_Guard_Helper invalid content"),-1===r.WOWOK_OBJECTS_TYPE().findIndex((e=>e.includes("guard::Guard")&&e==t.type))&&(0,o.f)(o.I.Fail,"Parse_Guard_Helper invalid type: "+t.type),t.fields.input.type===r.package("base")+"::bcs::BCS"){const r=i.parse_constant(t.fields.constants),a=i.parse_bcs(r,Uint8Array.from(t.fields.input.fields.bytes));s.guard_list.push({id:t.fields.id.id,input:[...a],constant:[...r],digest:e.data?.digest??"",version:e.data?.version??""})}else(0,o.f)(o.I.Fail,"Parse_Guard_Helper invalid package: "+t.fields.input.type)})),s}done_helper(e){let t=[],r=[];return this.guard_list.forEach((i=>{r.push(i.id),i.input.filter((e=>void 0!==e.cmd)).forEach((r=>{let s=r.value;s||void 0===r.identifier||(s=i.constant.find((e=>e.identifier==r.identifier))?.value);let a=e.find((e=>e.data?.objectId==s));a||(0,o.f)(o.I.Fail,"query object not match");let n=this.object_query(a.data);n||(0,o.f)(o.I.Fail,"query object fail"),t.push(n)}))})),{query:t,info:this.guard_list}}}i=c,c.DeGuardObject_FromData=(e,t)=>{let r=i.parse_constant(e),s=i.parse_bcs(r,t);s&&0!=s.length||(0,o.f)(o.I.Fail,"GuardObject: data parsed error");let a=[];return s.forEach((e=>{i.ResolveData(r,a,{...e,child:[]})})),1!=a.length&&(0,o.f)(o.I.Fail,"GuardObject: parse error"),{object:a.pop(),constant:r}},c.DeGuardObject=async(e,t)=>{(0,n.jE)(t)||(0,o.f)(o.I.IsValidAddress,"GuardObject guard");let r=await e.query_raw([t]);0!=r.length&&r[0].data&&r[0].data?.objectId==t||(0,o.f)(o.I.Fail,"GuardObject query error");let s=r[0].data.content;return s?.type!=e.package("base")+"::guard::Guard"&&(0,o.f)(o.I.Fail,"GuardObject object invalid"),i.DeGuardObject_FromData(s.fields.constants,s.fields.input.fields.bytes)},c.ResolveData=(e,t,r)=>{switch(r.type){case a.hu.TYPE_LOGIC_NOT:return r.ret_type=a.eV.TYPE_BOOL,t.length<1&&(0,o.f)(o.I.Fail,"ResolveData: TYPE_LOGIC_NOT"),(i=t.pop()).ret_type&&i.ret_type==a.eV.TYPE_BOOL||(0,o.f)(o.I.Fail,"ResolveData: TYPE_LOGIC_NOT type invalid"),r.child.push(i),void t.push(r);case a.hu.TYPE_NUMBER_ADDRESS:var i;return r.ret_type=a.eV.TYPE_ADDRESS,t.length<1&&(0,o.f)(o.I.Fail,"ResolveData: TYPE_NUMBER_ADDRESS"),(i=t.pop()).ret_type&&d.uR.match_u256(i.ret_type)||(0,o.f)(o.I.Fail,"ResolveData: TYPE_NUMBER_ADDRESS type invalid"),r.child.push(i),void t.push(r);case a.hu.TYPE_LOGIC_AS_U256_GREATER:case a.hu.TYPE_LOGIC_AS_U256_GREATER_EQUAL:case a.hu.TYPE_LOGIC_AS_U256_LESSER:case a.hu.TYPE_LOGIC_AS_U256_LESSER_EQUAL:case a.hu.TYPE_LOGIC_AS_U256_EQUAL:case a.hu.TYPE_NUMBER_ADD:case a.hu.TYPE_NUMBER_DEVIDE:case a.hu.TYPE_NUMBER_MOD:case a.hu.TYPE_NUMBER_MULTIPLY:case a.hu.TYPE_NUMBER_SUBTRACT:r.type===a.hu.TYPE_LOGIC_AS_U256_GREATER||r.type===a.hu.TYPE_LOGIC_AS_U256_GREATER_EQUAL||r.type===a.hu.TYPE_LOGIC_AS_U256_LESSER||r.type===a.hu.TYPE_LOGIC_AS_U256_LESSER_EQUAL||r.type===a.hu.TYPE_LOGIC_AS_U256_EQUAL?r.ret_type=a.eV.TYPE_BOOL:r.ret_type=a.eV.TYPE_U256,(t.length<r.value||r.value<2)&&(0,o.f)(o.I.Fail,"ResolveData: "+r.type);for(let e=0;e<r.value;++e)(n=t.pop()).ret_type&&d.uR.match_u256(n.ret_type)||(0,o.f)(o.I.Fail,"ResolveData: "+r.type+" INVALID param type"),r.child.push(n);return void t.push(r);case a.hu.TYPE_LOGIC_EQUAL:r.ret_type=a.eV.TYPE_BOOL,(t.length<r.value||r.value<2)&&(0,o.f)(o.I.Fail,"ResolveData: "+r.type);var s=t.pop();r.child.push(s);for(let e=1;e<r.value;++e)(n=t.pop()).ret_type&&n.ret_type==s.ret_type||(0,o.f)(o.I.Fail,"ResolveData: "+r.type+" INVALID param type"),r.child.push(n);return void t.push(r);case a.hu.TYPE_LOGIC_HAS_SUBSTRING:r.ret_type=a.eV.TYPE_BOOL,(t.length<r.value||r.value<2)&&(0,o.f)(o.I.Fail,"ResolveData: "+r.type);for(let e=0;e<r.value;++e)(n=t.pop()).ret_type&&n.ret_type==a.eV.TYPE_STRING||(0,o.f)(o.I.Fail,"ResolveData: "+r.type+" INVALID param type"),r.child.push(n);return void t.push(r);case a.hu.TYPE_LOGIC_AND:case a.hu.TYPE_LOGIC_OR:r.ret_type=a.eV.TYPE_BOOL,(t.length<r.value||r.value<2)&&(0,o.f)(o.I.Fail,"ResolveData: "+r.type);for(let e=0;e<r.value;++e){var n;(n=t.pop()).ret_type&&n.ret_type==a.eV.TYPE_BOOL||(0,o.f)(o.I.Fail,"ResolveData: "+r.type+" INVALID param type"),r.child.push(n)}return void t.push(r);case a.hu.TYPE_QUERY:r?.cmd||(0,o.f)(o.I.Fail,"OperateParamCount: cmd invalid "+r.type);let c=d.wM.GetCmd(r.cmd);return c||(0,o.f)(o.I.Fail,"OperateParamCount: cmd not supported "+r.type),r.ret_type=c?.return,t.length<c.parameters.length&&(0,o.f)(o.I.Fail,"OperateParamCount: cmd param lost "+r.type),c.parameters.forEach((e=>{let i=t.pop();i?.ret_type&&i.ret_type==e||(0,o.f)(o.I.Fail,"OperateParamCount: cmd param not match "+r.type),r.child.push(i)})),void t.push(r);case a.eV.TYPE_ADDRESS:case a.eV.TYPE_BOOL:case a.eV.TYPE_U128:case a.eV.TYPE_U256:case a.eV.TYPE_U64:case a.eV.TYPE_U8:case a.eV.TYPE_VEC_ADDRESS:case a.eV.TYPE_VEC_BOOL:case a.eV.TYPE_VEC_U128:case a.eV.TYPE_VEC_U256:case a.eV.TYPE_VEC_U64:case a.eV.TYPE_VEC_U8:case a.eV.TYPE_VEC_VEC_U8:case a.eV.TYPE_OPTION_ADDRESS:case a.eV.TYPE_OPTION_BOOL:case a.eV.TYPE_OPTION_U128:case a.eV.TYPE_OPTION_U256:case a.eV.TYPE_OPTION_U64:case a.eV.TYPE_OPTION_U8:case a.eV.TYPE_STRING:return r.ret_type=r.type,void t.push(r);case a.EL.TYPE_CLOCK:return r.ret_type=a.eV.TYPE_U64,void t.push(r);case a.EL.TYPE_SIGNER:case a.EL.TYPE_GUARD:return r.ret_type=a.eV.TYPE_ADDRESS,void t.push(r);case a.EL.TYPE_CONSTANT:let _=e.find((e=>e.identifier==r?.identifier));return _||(0,o.f)(o.I.Fail,"OperateParamCount: identifier  invalid "+r.type),r.ret_type=_?.type,void t.push(r)}(0,o.f)(o.I.Fail,"OperateParamCount: type  invalid "+r.type)},c.Create=async(e,t)=>{if(!(0,n.ij)(e,n.jE))return void(t&&t(void 0));let r=(0,n.SI)(e);if(!t){const t=await a.Zs.Instance().query_raw(r);return i.Parse_Guard_Helper(e,t)}a.Zs.Instance().query_raw(r).then((r=>{t(i.Parse_Guard_Helper(e,r))})).catch((e=>{console.log(e),t(void 0)}))},c.parse_constant=e=>{let t=[];return e.forEach((e=>{let r=e?.fields??e;const i=Uint8Array.from(r.value),s=i.slice(0,1)[0];if(r.bWitness)t.push({identifier:r.identifier,type:s,bWitness:r.bWitness,value:void 0});else{var d=i.slice(1);switch(s){case a.eV.TYPE_ADDRESS:d="0x"+n.ji.getInstance().de(a.eV.TYPE_ADDRESS,Uint8Array.from(d)).toString();break;case a.eV.TYPE_BOOL:case a.eV.TYPE_U8:case a.eV.TYPE_U64:case a.eV.TYPE_U128:case a.eV.TYPE_U256:case a.eV.TYPE_VEC_U8:case a.eV.TYPE_VEC_U64:case a.eV.TYPE_VEC_U128:case a.eV.TYPE_VEC_ADDRESS:case a.eV.TYPE_VEC_BOOL:case a.eV.TYPE_VEC_VEC_U8:case a.eV.TYPE_OPTION_ADDRESS:case a.eV.TYPE_OPTION_BOOL:case a.eV.TYPE_OPTION_U128:case a.eV.TYPE_OPTION_U8:case a.eV.TYPE_OPTION_U64:case a.eV.TYPE_OPTION_U256:case a.eV.TYPE_VEC_U256:case a.eV.TYPE_STRING:case a.eV.TYPE_OPTION_STRING:case a.eV.TYPE_OPTION_VEC_U8:case a.eV.TYPE_VEC_STRING:a.Bd.find((e=>e.type==s))||(0,o.f)(o.I.Fail,"GuardObject de error"),d=n.ji.getInstance().de(s,Uint8Array.from(d));break;default:(0,o.f)(o.I.Fail,"GuardObject constant type invalid:"+s)}t.push({identifier:r.identifier,type:s,bWitness:r.bWitness,value:d})}})),t},c.parse_bcs=(e,t)=>{let r=Uint8Array.from(t),i=[].slice.call(r.reverse()),s=[];for(;i.length>0;){let t,r,d,c=i.shift();switch(c){case a.EL.TYPE_SIGNER:case a.EL.TYPE_CLOCK:case a.EL.TYPE_GUARD:case a.hu.TYPE_LOGIC_NOT:case a.hu.TYPE_NUMBER_ADDRESS:break;case a.hu.TYPE_LOGIC_AS_U256_GREATER:case a.hu.TYPE_LOGIC_AS_U256_GREATER_EQUAL:case a.hu.TYPE_LOGIC_AS_U256_LESSER:case a.hu.TYPE_LOGIC_AS_U256_LESSER_EQUAL:case a.hu.TYPE_LOGIC_AS_U256_EQUAL:case a.hu.TYPE_LOGIC_EQUAL:case a.hu.TYPE_LOGIC_HAS_SUBSTRING:case a.hu.TYPE_NUMBER_ADD:case a.hu.TYPE_NUMBER_DEVIDE:case a.hu.TYPE_NUMBER_MOD:case a.hu.TYPE_NUMBER_MULTIPLY:case a.hu.TYPE_NUMBER_SUBTRACT:case a.hu.TYPE_LOGIC_AND:case a.hu.TYPE_LOGIC_OR:t=i.shift();break;case a.EL.TYPE_CONSTANT:d=i.shift();break;case a.eV.TYPE_ADDRESS:t="0x"+n.ji.getInstance().de(a.eV.TYPE_ADDRESS,Uint8Array.from(i)).toString(),i.splice(0,32);break;case a.eV.TYPE_BOOL:case a.eV.TYPE_U8:t=n.ji.getInstance().de(c,Uint8Array.from(i)),i.shift();break;case a.eV.TYPE_U64:t=n.ji.getInstance().de(c,Uint8Array.from(i)),i.splice(0,8);break;case a.eV.TYPE_U128:t=n.ji.getInstance().de(c,Uint8Array.from(i)),i.splice(0,16);break;case a.eV.TYPE_U256:t=n.ji.getInstance().de(c,Uint8Array.from(i)),i.splice(0,32);break;case a.eV.TYPE_VEC_U8:case a.eV.TYPE_VEC_BOOL:case a.eV.TYPE_STRING:let s=(0,n.jz)(Uint8Array.from(i));t=n.ji.getInstance().de(c,Uint8Array.from(i)),i.splice(0,s.value+s.length);break;case a.eV.TYPE_VEC_ADDRESS:s=(0,n.jz)(Uint8Array.from(i)),t=n.ji.getInstance().de(c,Uint8Array.from(i)),i.splice(0,32*s.value+s.length);break;case a.eV.TYPE_VEC_U128:s=(0,n.jz)(Uint8Array.from(i)),t=n.ji.getInstance().de(c,Uint8Array.from(i)),i.splice(0,16*s.value+s.length);break;case a.eV.TYPE_VEC_U256:s=(0,n.jz)(Uint8Array.from(i)),t=n.ji.getInstance().de(c,Uint8Array.from(i)),i.splice(0,32*s.value+s.length);break;case a.eV.TYPE_VEC_U64:s=(0,n.jz)(Uint8Array.from(i)),t=n.ji.getInstance().de(c,Uint8Array.from(i)),i.splice(0,8*s.value+s.length);break;case a.eV.TYPE_VEC_VEC_U8:case a.eV.TYPE_VEC_STRING:s=(0,n.jz)(Uint8Array.from(i)),i.splice(0,s.length);let _=[];for(let e=0;e<s.value;e++){let e=(0,n.jz)(Uint8Array.from(i));_.push(n.ji.getInstance().de(a.eV.TYPE_VEC_U8,Uint8Array.from(i))),i.splice(0,e.length+e.value)}t=_;break;case a.hu.TYPE_QUERY:let u=i.splice(0,1);if(u[0]==a.eV.TYPE_ADDRESS){let e="0x"+n.ji.getInstance().de(a.eV.TYPE_ADDRESS,Uint8Array.from(i)).toString();i.splice(0,32),t=e,r=n.ji.getInstance().de("u16",Uint8Array.from(i.splice(0,2)))}else if(u[0]==a.EL.TYPE_CONSTANT){let t=i.splice(0,1);e.find((e=>e.identifier==t[0]&&e.type==a.eV.TYPE_ADDRESS))||(0,o.f)(o.I.Fail,"GuardObject: indentifier not in  constant"),d=t[0],r=n.ji.getInstance().de("u16",Uint8Array.from(i.splice(0,2)))}else(0,o.f)(o.I.Fail,"GuardObject: constant type invalid");break;case a.eV.TYPE_OPTION_ADDRESS:let p=(0,n.gz)(i,a.eV.TYPE_ADDRESS);t=p.value,p.bNone||i.splice(0,32);break;case a.eV.TYPE_OPTION_BOOL:p=(0,n.gz)(i,a.eV.TYPE_BOOL),t=p.value,p.bNone||i.splice(0,1);break;case a.eV.TYPE_OPTION_U8:p=(0,n.gz)(i,a.eV.TYPE_U8),t=p.value,p.bNone||i.splice(0,1);break;case a.eV.TYPE_OPTION_U128:p=(0,n.gz)(i,a.eV.TYPE_U128),t=p.value,p.bNone||i.splice(0,16);break;case a.eV.TYPE_OPTION_U256:p=(0,n.gz)(i,a.eV.TYPE_U256),t=p.value,p.bNone||i.splice(0,32);break;case a.eV.TYPE_OPTION_U64:p=(0,n.gz)(i,a.eV.TYPE_U64),t=p.value,p.bNone||i.splice(0,8);break;case a.eV.TYPE_OPTION_STRING:p=(0,n.Hn)(i),t=p.value;break;default:(0,o.f)(o.I.Fail,"GuardObject: parse_bcs types "+c)}s.push({type:c,value:t,cmd:r,identifier:d})}return s};class _{get_object(){return this.passport}constructor(e,t){this.query_result_async=async e=>{this.txb.moveCall({target:a.Zs.Instance().passportFn("query_result"),arguments:[this.passport]});const t=await a.Zs.Client().devInspectTransactionBlock({sender:e,transactionBlock:this.txb});return _.ResolveQueryRes(this.txb,t)},(0===t.info.length||t.info.length>_.MAX_GUARD_COUNT)&&(0,o.f)(o.I.InvalidParam,"guards"),this.txb=e,this.passport=this.txb.moveCall({target:a.Zs.Instance().passportFn("new"),arguments:[]}),t.info.forEach((t=>{const r=t.constant.filter((e=>e.bWitness)).map((e=>e.identifier)),i=t.constant.filter((e=>e.bWitness)).map((e=>{const t=n.ji.getInstance().ser(e.type,e.value);let r=new Uint8Array(t.length+1);return r.set([e.type],0),r.set(t,1),[].slice.call(r)})),s=void 0!==t.version&&void 0!==t.digest?e.objectRef({objectId:t.id,version:t.version,digest:t.digest}):e.object(t.id);this.txb.moveCall({target:a.Zs.Instance().passportFn("guard_add"),arguments:[this.passport,s,this.txb.pure.vector("u8",[].slice.call(r)),this.txb.pure(n.ji.getInstance().ser("vector<vector<u8>>",[...i]))]})}));const r=this.txb.sharedObjectRef(a.Zs.CLOCK_OBJECT);t?.query.forEach((e=>{this.txb.moveCall({target:a.Zs.Instance().passportFn("passport_verify"),arguments:[this.passport,this.txb.object(r)]}),this.txb.moveCall({target:e.target,arguments:[this.txb.object(e.id),this.passport],typeArguments:e.types})})),this.txb.moveCall({target:a.Zs.Instance().passportFn("passport_verify"),arguments:[this.passport,this.txb.object(r)]})}destroy(){this.txb.moveCall({target:a.Zs.Instance().passportFn("destroy"),arguments:[this.passport]})}freeze(){this.txb.moveCall({target:a.Zs.Instance().passportFn("freezen"),arguments:[this.passport]})}query_result(e,t){this.txb.moveCall({target:a.Zs.Instance().passportFn("query_result"),arguments:[this.passport]}),a.Zs.Client().devInspectTransactionBlock({sender:e,transactionBlock:this.txb}).then((e=>{const r=_.ResolveQueryRes(this.txb,e);r&&t(r)})).catch((e=>{console.log(e)}))}static ResolveQueryRes(e,t){for(let r=0;r<t.results?.length;++r){const i=t.results[r];if(i?.returnValues&&2===i.returnValues.length&&"bool"===i.returnValues[0][1]&&"vector<address>"===i.returnValues[1][1])return{txb:e,result:n.ji.getInstance().de("bool",Uint8Array.from(i.returnValues[0][0])),guards:n.ji.getInstance().de("vector<address>",Uint8Array.from(i.returnValues[1][0])).map((e=>"0x"+e))}}}}_.MAX_GUARD_COUNT=8},4179:(e,t,r)=>{r.d(t,{K:()=>o,e:()=>n});var i=r(7745),s=r(9880),a=r(572);const n=200;function o(e,t,r){t||(0,a.f)(a.I.InvalidParam,"Payment.New.pay_token_type"),r.receiver.length>n&&(0,a.f)(a.I.InvalidParam,"Payment.New.param.receiver"),(0,s.ij)(r.receiver,(e=>(0,s.jE)(e.address)&&i.Zs.IsValidObjects([e.coin])))||(0,a.f)(a.I.IsValidArray,"Payment.New.param.receiver"),r?.for_object&&!(0,s.jE)(r.for_object)&&(0,a.f)(a.I.IsValidAddress,"Payment.New.param.for_object"),r?.for_guard&&!(0,s.jE)(r.for_guard)&&(0,a.f)(a.I.IsValidAddress,"Payment.New.param.for_guard"),r?.business_remark&&!(0,s.yW)(r?.business_remark)&&(0,a.f)(a.I.IsValidDesription,"Payment.New.param.business_remark");let o=e.pure.option("address",r.for_object?r.for_object:void 0);const d=e.sharedObjectRef(i.Zs.CLOCK_OBJECT);return r.for_guard?e.moveCall({target:i.Zs.Instance().paymentFn("create_withGuard"),arguments:[e.pure.vector("address",r.receiver.map((e=>e.address))),e.makeMoveVec({elements:r.receiver.map((e=>e.coin))}),o,e.object(r.for_guard),e.pure.u64(r.business_index),e.pure.string(r.business_remark),e.object(d)],typeArguments:[t]}):e.moveCall({target:i.Zs.Instance().paymentFn("create"),arguments:[e.pure.vector("address",r.receiver.map((e=>e.address))),e.makeMoveVec({elements:r.receiver.map((e=>e.coin))}),o,e.pure.u64(r.business_index),e.pure.string(r.business_remark),e.object(d)],typeArguments:[t]})}},9650:(e,t,r)=>{r.d(t,{_$:()=>d,aX:()=>c,w6:()=>i});var i,s=r(7745),a=r(9880),n=r(572),o=r(8551);!function(e){e[e.repository=100]="repository",e[e.repository_description=101]="repository_description",e[e.repository_mode=102]="repository_mode",e[e.repository_policies=103]="repository_policies",e[e.repository_reference=104]="repository_reference",e[e.service=200]="service",e[e.service_description=201]="service_description",e[e.service_sales=202]="service_sales",e[e.service_payee=203]="service_payee",e[e.service_repository=204]="service_repository",e[e.service_withdraw_guards=205]="service_withdraw_guards",e[e.service_refund_guards=206]="service_refund_guards",e[e.service_discount_transfer=207]="service_discount_transfer",e[e.service_withdraw=208]="service_withdraw",e[e.service_buyer_guard=209]="service_buyer_guard",e[e.service_machine=210]="service_machine",e[e.service_endpoint=211]="service_endpoint",e[e.service_publish=212]="service_publish",e[e.service_clone=213]="service_clone",e[e.service_customer_required=214]="service_customer_required",e[e.service_pause=215]="service_pause",e[e.service_treasury=216]="service_treasury",e[e.service_arbitration=217]="service_arbitration",e[e.demand=260]="demand",e[e.demand_refund=261]="demand_refund",e[e.demand_expand_time=262]="demand_expand_time",e[e.demand_guard=263]="demand_guard",e[e.demand_description=264]="demand_description",e[e.demand_yes=265]="demand_yes",e[e.machine=600]="machine",e[e.machine_description=601]="machine_description",e[e.machine_repository=602]="machine_repository",e[e.machine_clone=604]="machine_clone",e[e.machine_node=606]="machine_node",e[e.machine_endpoint=608]="machine_endpoint",e[e.machine_pause=609]="machine_pause",e[e.machine_publish=610]="machine_publish",e[e.progress=650]="progress",e[e.progress_namedOperator=651]="progress_namedOperator",e[e.progress_bind_task=652]="progress_bind_task",e[e.progress_context_repository=653]="progress_context_repository",e[e.progress_unhold=654]="progress_unhold",e[e.progress_parent=655]="progress_parent",e[e.treasury=700]="treasury",e[e.treasury_receive=701]="treasury_receive",e[e.treasury_deposit=702]="treasury_deposit",e[e.treasury_withdraw=703]="treasury_withdraw",e[e.treasury_descritption=704]="treasury_descritption",e[e.treasury_deposit_guard=705]="treasury_deposit_guard",e[e.treasury_withdraw_mode=706]="treasury_withdraw_mode",e[e.treasury_withdraw_guard=707]="treasury_withdraw_guard",e[e.arbitration=800]="arbitration",e[e.arbitration_description=801]="arbitration_description",e[e.arbitration_fee=802]="arbitration_fee",e[e.arbitration_voting_guard=803]="arbitration_voting_guard",e[e.arbitration_endpoint=804]="arbitration_endpoint",e[e.arbitration_guard=805]="arbitration_guard",e[e.arbitration_pause=806]="arbitration_pause",e[e.arbitration_vote=807]="arbitration_vote",e[e.arbitration_arbitration=808]="arbitration_arbitration",e[e.arbitration_withdraw=809]="arbitration_withdraw",e[e.arbitration_treasury=810]="arbitration_treasury",e[e.user_defined_start=1e3]="user_defined_start"}(i||(i={}));const d=[{index:i.repository,name:"Repository",description:"Launch new Repository",module:s.e$.repository},{index:i.repository_description,name:"Description",description:"Set Repository description",module:s.e$.repository},{index:i.repository_mode,name:"Policy mode",description:"Set Repository mode",module:s.e$.repository},{index:i.repository_policies,name:"Policy",description:"Set Repository policies",module:s.e$.repository},{index:i.repository_reference,name:"Reference",description:"Set Repository reference",module:s.e$.repository},{index:i.service,name:"Service",description:"Launch new Service",module:s.e$.service},{index:i.service_description,name:"Description",description:"Set Service description",module:s.e$.service},{index:i.service_sales,name:"Sales",description:"Set Service sales items",module:s.e$.service},{index:i.service_payee,name:"Payee",description:"Set Service payee",module:s.e$.service},{index:i.service_repository,name:"Repository",description:"Set Service repositories",module:s.e$.service},{index:i.service_withdraw_guards,name:"Withdraw Guard",description:"Set Service withdraw guards",module:s.e$.service},{index:i.service_refund_guards,name:"Refund Guard",description:"Set Service refund guards",module:s.e$.service},{index:i.service_discount_transfer,name:"Discount",description:"Launch discounts for Service",module:s.e$.service},{index:i.service_buyer_guard,name:"Buyer Guard",description:"Set Guard of buying for Service",module:s.e$.service},{index:i.service_machine,name:"Machine",description:"Set Machine for Service",module:s.e$.service},{index:i.service_endpoint,name:"Endpoint",description:"Set Service endpoint",module:s.e$.service},{index:i.service_publish,name:"Publish",description:"Allowing the creation of Order",module:s.e$.service},{index:i.service_clone,name:"Clone",description:"Clone Service",module:s.e$.service},{index:i.service_customer_required,name:"Buyer info",description:"Set Service buyer info required",module:s.e$.service},{index:i.service_pause,name:"Pause",description:"Pause/Unpause Service",module:s.e$.service},{index:i.service_treasury,name:"Treasury",description:"Externally withdrawable treasury for compensation or rewards",module:s.e$.service},{index:i.service_arbitration,name:"Arbitration",description:"Add/Remove arbitration that allows refunds from orders at any time based on arbitration results",module:s.e$.service},{index:i.demand,name:"Demand",description:"Launch new Demand",module:s.e$.demand},{index:i.demand_refund,name:"Refund",description:"Refund from Demand",module:s.e$.demand},{index:i.demand_expand_time,name:"Expand deadline",description:"Expand Demand deadline",module:s.e$.demand},{index:i.demand_guard,name:"Guard",description:"Set Demand guard",module:s.e$.demand},{index:i.demand_description,name:"Description",description:"Set Demand description",module:s.e$.demand},{index:i.demand_yes,name:"Yes",description:"Pick the Deamand serice",module:s.e$.demand},{index:i.machine,name:"Machine",description:"Launch new Machine",module:s.e$.machine},{index:i.machine_description,name:"Description",description:"Set Machine description",module:s.e$.machine},{index:i.machine_repository,name:"Repository",description:"Set Machine repository",module:s.e$.machine},{index:i.machine_clone,name:"Clone",description:"Clone Machine",module:s.e$.machine},{index:i.machine_node,name:"Node",description:"Set Machine nodes",module:s.e$.machine},{index:i.machine_endpoint,name:"Endpoint",description:"Set Machine endpoint",module:s.e$.machine},{index:i.machine_pause,name:"Pause",description:"Pause/Unpause Machine",module:s.e$.machine},{index:i.machine_publish,name:"Publish",description:"Allowing the creation of Progress",module:s.e$.machine},{index:i.progress,name:"Progress",description:"Launch new Progress",module:s.e$.progress},{index:i.progress_namedOperator,name:"Operator",description:"Set Progress operators",module:s.e$.progress},{index:i.progress_bind_task,name:"Bind",description:"Set Progress task",module:s.e$.progress},{index:i.progress_context_repository,name:"Repository",description:"Set Progress repository",module:s.e$.progress},{index:i.progress_unhold,name:"Unhold",description:"Release Progress holdings",module:s.e$.progress},{index:i.progress_parent,name:"Parent",description:"Set Progress parent",module:s.e$.progress},{index:i.treasury,name:"Treasury",description:"Launch new Treasury",module:s.e$.treasury},{index:i.treasury_deposit,name:"Deposit",description:"Deposit coins",module:s.e$.treasury},{index:i.treasury_receive,name:"Receive",description:"Receive coins from some address sent",module:s.e$.treasury},{index:i.treasury_withdraw,name:"Withdraw",description:"Withdraw coins",module:s.e$.treasury},{index:i.treasury_withdraw_guard,name:"Withdraw Guard",description:"Add/Remove Treasury withdraw guard",module:s.e$.treasury},{index:i.treasury_withdraw_mode,name:"Withdraw mode",description:"Set Treasury withdraw mode",module:s.e$.treasury},{index:i.treasury_deposit_guard,name:"Deposit Guard",description:"Set Treasury deposit guard",module:s.e$.treasury},{index:i.treasury_descritption,name:"Description",description:"Set Treasury description",module:s.e$.treasury},{index:i.arbitration,name:"Arbitration",description:"Launch new Arbitration",module:s.e$.arbitration},{index:i.arbitration_description,name:"Description",description:"Set Arbitration description",module:s.e$.arbitration},{index:i.arbitration_endpoint,name:"Endpoint",description:"Set Arbitration endpoint",module:s.e$.arbitration},{index:i.arbitration_fee,name:"Fee",description:"Set Arbitration fee",module:s.e$.arbitration},{index:i.arbitration_guard,name:"Guard",description:"Set Guard to apply for arbitration",module:s.e$.arbitration},{index:i.arbitration_arbitration,name:"Arbitrate",description:"Determine the outcome of arbitration",module:s.e$.arbitration},{index:i.arbitration_pause,name:"Pause",description:"Allowing/forbidding the creation of Arb",module:s.e$.arbitration},{index:i.arbitration_voting_guard,name:"Voting Guard",description:"Add/Remove voting Guard",module:s.e$.arbitration},{index:i.arbitration_vote,name:"Vote",description:"Vote on the application for arbitration",module:s.e$.arbitration},{index:i.arbitration_withdraw,name:"Withdraw",description:"Withdraw the arbitration fee",module:s.e$.arbitration},{index:i.arbitration_treasury,name:"Withdraw",description:"Set Treasury that fees was collected at the time of withdrawal",module:s.e$.arbitration}];class c{get_object(){return this.object}constructor(e){this.txb=e,this.object=""}static From(e,t){let r=new c(e);return r.object=s.Zs.TXB_OBJECT(e,t),r}static New(e,t){(0,a.yW)(t)||(0,n.f)(n.I.IsValidDesription);let r=new c(e);return r.object=e.moveCall({target:s.Zs.Instance().permissionFn("new"),arguments:[e.pure.string(t)]}),r}launch(){return this.txb.moveCall({target:s.Zs.Instance().permissionFn("create"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object)]})}add_bizPermission(e,t){c.IsValidBizPermissionIndex(e)||(0,n.f)(n.I.IsValidBizPermissionIndex,"add_bizPermission"),(0,a.S7)(t)||(0,n.f)(n.I.IsValidName,"add_bizPermission"),this.txb.moveCall({target:s.Zs.Instance().permissionFn("user_define_add"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.u64(e),this.txb.pure.string(t)]})}remove_bizPermission(e){c.IsValidBizPermissionIndex(e)||(0,n.f)(n.I.IsValidBizPermissionIndex,"remove_bizPermission"),this.txb.moveCall({target:s.Zs.Instance().permissionFn("user_define_remove"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.u64(e)]})}transfer_permission(e,t){(0,a.jE)(e)&&(0,a.jE)(t)||(0,n.f)(n.I.IsValidAddress,"transfer_permission"),this.txb.moveCall({target:s.Zs.Instance().permissionFn("change_entity"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.address(e),this.txb.pure.address(t)]})}add_entity2(e,t){0!==e.length&&((0,a.ij)(e,a.jE)||(0,n.f)(n.I.IsValidArray,"add_entity2"),void 0!==t?this.txb.moveCall({target:s.Zs.Instance().permissionFn("add_with_index"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.u64(t),this.txb.pure.vector("address",(0,a.SI)(e))]}):this.txb.moveCall({target:s.Zs.Instance().permissionFn("add"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.vector("address",(0,a.SI)(e))]}))}add_entity3(e){if(0===e.length)return;const t=[];e.forEach((e=>{e.entities.forEach((r=>{const i=t.find((e=>e.address===r.address));if(i){const t=i.permissions.find((t=>t.index===e.index));t?t.guard=r.guard:i.permissions.push({guard:r.guard,index:e.index})}else t.push({address:r.address,permissions:[{guard:r.guard,index:e.index}]})}))})),this.add_entity(t)}add_entity(e){if(0===e.length)return;let t=!0;e.forEach((e=>{(0,a.jE)(e.address)||(t=!1),e.permissions.forEach((e=>{c.IsValidPermissionIndex(e.index)||(t=!1),e?.guard&&!s.Zs.IsValidObjects([e.guard])&&(t=!1)}))})),t||(0,n.f)(n.I.InvalidParam,"add_entity.entities");let r=[];for(let t=0;t<e.length;t++){let i=e[t],a=[];for(let e=0;e<i.permissions.length;e++){let t=i.permissions[e];c.IsValidPermissionIndex(t.index)&&(a.includes(t.index)||(a.push(t.index),t?.guard&&r.push({address:i.address,index:t.index,guard:t.guard})))}a.length>0&&this.txb.moveCall({target:s.Zs.Instance().permissionFn("add_batch"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.address(i.address),this.txb.pure.vector("u64",a)]})}r.forEach((({address:e,index:t,guard:r})=>{this.txb.moveCall({target:s.Zs.Instance().permissionFn("guard_set"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.address(e),this.txb.pure.u64(t),s.Zs.TXB_OBJECT(this.txb,r)]})}))}set_guard(e,t,r){(0,a.jE)(e)||(0,n.f)(n.I.IsValidAddress,"address"),c.IsValidPermissionIndex(t)||c.IsValidBizPermissionIndex(t)||(0,n.f)(n.I.IsValidPermissionIndex,"index"),r?this.txb.moveCall({target:s.Zs.Instance().permissionFn("guard_set"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.address(e),this.txb.pure.u64(t),s.Zs.TXB_OBJECT(this.txb,r)]}):this.txb.moveCall({target:s.Zs.Instance().permissionFn("guard_none"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.address(e),this.txb.pure.u64(t)]})}remove_index(e,t){(0,a.jE)(e)||(0,n.f)(n.I.IsValidAddress),0!==t.length&&((0,a.ij)(t,c.IsValidPermissionIndex)||(0,n.f)(n.I.InvalidParam,"index"),this.txb.moveCall({target:s.Zs.Instance().permissionFn("remove_index"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.address(e),this.txb.pure.vector("u64",(0,a.SI)(t))]}))}remove_entity(e){0!==e.length&&((0,a.ij)(e,a.jE)||(0,n.f)(n.I.IsValidArray),this.txb.moveCall({target:s.Zs.Instance().permissionFn("remove"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.vector("address",(0,a.SI)(e))]}))}set_description(e){(0,a.yW)(e)||(0,n.f)(n.I.IsValidDesription),this.txb.moveCall({target:s.Zs.Instance().permissionFn("description_set"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.string(e)]})}add_admin(e){0!==e.length&&((0,a.ij)(e,a.jE)||(0,n.f)(n.I.IsValidArray),this.txb.moveCall({target:s.Zs.Instance().permissionFn("admin_add_batch"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.vector("address",(0,a.SI)(e))]}))}remove_admin(e,t){(t||0!==e.length)&&((0,a.ij)(e,a.jE)||(0,n.f)(n.I.IsValidArray,"admin"),t?this.txb.moveCall({target:s.Zs.Instance().permissionFn("admins_clear"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object)]}):e&&this.txb.moveCall({target:s.Zs.Instance().permissionFn("admin_remove_batch"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.vector("address",(0,a.SI)(e))]}))}change_owner(e){(0,a.jE)(e)||(0,n.f)(n.I.IsValidAddress),this.txb.moveCall({target:s.Zs.Instance().permissionFn("builder_set"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.address(e)]})}query_permissions_all(e){(0,a.jE)(e)||(0,n.f)(n.I.InvalidParam,"query_permissions"),this.txb.moveCall({target:s.Zs.Instance().permissionFn("query_permissions_all"),arguments:[s.Zs.TXB_OBJECT(this.txb,this.object),this.txb.pure.address(e)]})}QueryPermissions(e,t,r,i){this.query_permissions_all(t),s.Zs.Client().devInspectTransactionBlock({sender:i??t,transactionBlock:this.txb}).then((i=>{if(i.results&&i.results[0].returnValues&&2!==i.results[0].returnValues.length)return void r({who:t,object:e});const s=a.ji.getInstance().de(o.r8.U8,Uint8Array.from(i.results[0].returnValues[0][0]));if(s===c.PERMISSION_ADMIN||s===c.PERMISSION_OWNER_AND_ADMIN)r({who:t,admin:!0,owner:s%2==1,items:[],object:e});else{const n=a.ji.getInstance().de_perms(Uint8Array.from(i.results[0].returnValues[1][0]));r({who:t,admin:!1,owner:s%2==1,items:n.map((e=>({query:e?.index,permission:!0,guard:e?.guard}))),object:e})}})).catch((i=>{console.log(i),r({who:t,object:e})}))}static HasPermission(e,t,r=!1){if(e){if(e.admin)return{has:!0,owner:e.owner};let r=e.items?.find((e=>e.query==t));return r?{has:r.permission,guard:r.guard,owner:e.owner}:{has:!1,guard:void 0,owner:e?.owner}}if(r)return{has:!1,guard:void 0,owner:!1}}}c.MAX_ADMIN_COUNT=64,c.MAX_ENTITY_COUNT=2e3,c.MAX_PERMISSION_INDEX_COUNT=200,c.MAX_PERSONAL_PERMISSION_COUNT=200,c.PERMISSION_NORMAL=0,c.PERMISSION_OWNER=1,c.PERMISSION_ADMIN=2,c.PERMISSION_OWNER_AND_ADMIN=3,c.BUSINESS_PERMISSIONS_START=i.user_defined_start,c.IsValidBizPermissionIndex=e=>e>=c.BUSINESS_PERMISSIONS_START&&(0,a.Ec)(e),c.IsValidPermissionIndex=e=>!!Object.values(i).includes(e)||c.IsValidBizPermissionIndex(e)}}]);