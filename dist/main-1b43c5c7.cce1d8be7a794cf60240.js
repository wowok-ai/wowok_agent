"use strict";(this.webpackChunkwowok_agent=this.webpackChunkwowok_agent||[]).push([[661],{3170:(e,r,t)=>{t.d(r,{O:()=>i,l:()=>a});var s=t(7838);const i=async e=>{try{const r=JSON.parse(e);return JSON.stringify({data:await a(r)})}catch(e){return JSON.stringify({error:e})}},a=async e=>{(0,s.IsValidAddress)(e.permission_object)||(0,s.ERROR)(s.Errors.IsValidAddress,"permission.permission_object");const r=new s.TransactionBlock;s.Permission.From(r,e.permission_object).query_permissions_all(e.address);const t=await s.Protocol.Client().devInspectTransactionBlock({sender:e.address,transactionBlock:r});t.results&&t.results[0].returnValues&&2!==t.results[0].returnValues.length&&(0,s.ERROR)(s.Errors.Fail,"permission.retValues");const i=s.Bcs.getInstance().de(s.BCS.U8,Uint8Array.from(t.results[0].returnValues[0][0]));if(i===s.Permission.PERMISSION_ADMIN||i===s.Permission.PERMISSION_OWNER_AND_ADMIN)return{who:e.address,admin:!0,owner:i%2==1,items:[],object:e.permission_object};{const r=s.Bcs.getInstance().de_perms(Uint8Array.from(t.results[0].returnValues[1][0]));return{who:e.address,admin:!1,owner:i%2==1,items:r.map((e=>({query:e?.index,permission:!0,guard:e?.guard}))),object:e.permission_object}}}},4509:(e,r,t)=>{t.r(r),t.d(r,{Account:()=>w.g,CacheData:()=>n.HL,CacheName:()=>n.iN,CallArbitration:()=>d.k,CallBase:()=>o.s,CallDemand:()=>u.W,CallGuard:()=>_.g,CallMachine:()=>y.g,CallObjectPermission:()=>p.H,CallPermission:()=>c.Q,CallPersonal:()=>b.R,CallRepository:()=>m.t,CallService:()=>f.U,CallTreasury:()=>l.c,LocalStorageCache:()=>n.z7,MemeryCache:()=>n.a1,OBJECT_KEY:()=>n.WB,ResponseData:()=>o.$,WOWOK:()=>g,WowokCache:()=>n.c7,call_arbitration:()=>v.bi,call_arbitration_json:()=>v.os,call_demand:()=>v.ti,call_demand_json:()=>v.U1,call_guard:()=>v.JD,call_guard_json:()=>v.cm,call_machine:()=>v.h3,call_machine_json:()=>v._H,call_permission:()=>v.vF,call_permission_json:()=>v.q0,call_personal:()=>v.wi,call_personal_json:()=>v.nd,call_repository:()=>v.Um,call_repository_json:()=>v.H9,call_service:()=>v.ho,call_service_json:()=>v.q_,call_transfer_permission:()=>v.rL,call_transferpermission_json:()=>v.Tn,call_treasury:()=>v.Jj,call_treasury_json:()=>v.cW,data2object:()=>s.KV,queryTableItem_ArbVoting:()=>s.ff,queryTableItem_DemandService:()=>s.Pe,queryTableItem_MachineNode:()=>s.oT,queryTableItem_MarkTag:()=>s.iB,queryTableItem_PermissionEntity:()=>s.fG,queryTableItem_Personal:()=>s.h$,queryTableItem_ProgressHistory:()=>s.m4,queryTableItem_RepositoryData:()=>s.$q,queryTableItem_ServiceSale:()=>s.Xj,queryTableItem_TreasuryHistory:()=>s.oS,query_events:()=>a.N,query_events_json:()=>a.Y,query_objects:()=>s.w$,query_objects_json:()=>s.VB,query_permission:()=>i.l,query_permission_json:()=>i.O,query_personal_json:()=>s.F9,query_table:()=>s.EF,query_table_json:()=>s.LU,raw2type:()=>s.lS});var s=t(9605),i=t(3170),a=t(4192),n=t(603),o=t(9869),c=t(7647),d=t(2383),l=t(9201),p=t(4745),u=t(339),y=t(8947),m=t(7832),f=t(3605),_=t(7555),b=t(7340),w=t(5882),v=t(2429),g=t(7838)},9605:(e,r,t)=>{t.d(r,{$q:()=>w,EF:()=>l,F9:()=>o,KV:()=>P,LU:()=>n,Pe:()=>p,VB:()=>a,Xj:()=>f,fG:()=>u,ff:()=>y,h$:()=>d,iB:()=>v,lS:()=>k,m4:()=>_,oS:()=>b,oT:()=>m,w$:()=>c});var s=t(7838),i=t(603);const a=async e=>{try{const r=JSON.parse(e);return JSON.stringify({data:await c(r)})}catch(e){return JSON.stringify({error:e?.toString()})}},n=async e=>{try{const r=JSON.parse(e);return JSON.stringify({data:await l(r)})}catch(e){return JSON.stringify({error:e?.toString()})}},o=async e=>{try{const r=JSON.parse(e);return JSON.stringify({data:await d(r)??""})}catch(e){return JSON.stringify({error:e?.toString()})}},c=async e=>{var r=[];const t=[],a=(new Date).getTime(),n=i.c7.Instance().get(i.iN.object);if(n)for(let s=0;s<e.objects.length;++s){try{let o=n.load((0,i.WB)(e.objects[s],i.iN.object));if(o){const i=JSON.parse(o);if("INFINITE"!==i?.expire&&(e?.no_cache||i.expire<=a)&&(e.showOwner||e.showContent))t.push(e.objects[s]);else{const e=P(JSON.parse(i.data));e.cache_expire=i.expire,r.push(e)}}}catch(e){console.log(e)}t.push(e.objects[s])}if(t.length>0){const a=await s.Protocol.Client().multiGetObjects({ids:[...t],options:{showContent:e.showContent,showType:e.showType,showOwner:e.showOwner}}),n=i.c7.Instance().get(i.iN.object);if(n){const e=(new Date).getTime();a.forEach((r=>{try{if(r?.data){const t=r.data?.type??r.data?.content?.type??void 0,a=t?s.Protocol.Instance().object_name_from_type_repr(t):void 0,o={expire:"Guard"===a||"Payment"===a?"INFINITE":n.expire_time()+e,data:JSON.stringify(r.data)};n.save((0,i.WB)(r.data.objectId,i.iN.object),JSON.stringify(o))}}catch(e){console.log(e)}}))}r=r.concat(a.map((e=>P(e?.data))))}return{objects:r}},d=async e=>{(0,s.IsValidAddress)(e.address)||(0,s.ERROR)(s.Errors.IsValidAddress,"entity.address");const r=(new Date).getTime(),t=i.c7.Instance().get(i.iN.personal);if(t&&!e.no_cache)try{let s=t.load((0,i.WB)(e.address,i.iN.personal));if(s){const e=JSON.parse(s);if("INFINITE"===e?.expire||e.expire<=r){const r=JSON.parse(e.data);return r.cache_expire=e.expire,r}}}catch(e){console.log(e)}const a=await I(g(s.Protocol.Instance().objectEntity(),e.address));if("Personal"===a.type){if(t)try{const r=t.expire_time()+(new Date).getTime(),s={expire:r,data:JSON.stringify(a)};t.save((0,i.WB)(e.address,i.iN.personal),JSON.stringify(s)),a.cache_expire=r}catch(e){console.log(e)}return a}},l=async e=>{const r=await s.Protocol.Client().getDynamicFields({parentId:e.parent,cursor:e.cursor,limit:e.limit});return{items:r?.data?.map((e=>({object:e.objectId,type:e.type,version:e.version,key:{type:e.name.type,value:e.name.value}}))),nextCursor:r.nextCursor,hasNextPage:r.hasNextPage}},p=async e=>await I(g(e.object,e.address)),u=async e=>await I(g(e.object,e.address)),y=async e=>await I(g(e.object,e.address)),m=async e=>await I(j(e.object,e.name)),f=async e=>await I(j(e.object,e.name)),_=async e=>await I(h(e.object,e.index)),b=async e=>await I(h(e.object,e.index)),w=async e=>("string"!=typeof e.object&&(e.object=e.object.object),"string"!=typeof e.address&&(e.address=(0,s.uint2address)(e.address)),await I({parent:e.object,key:{type:s.Protocol.Instance().package("wowok")+"::repository::DataKey",value:{id:e.address,key:e.name}}})),v=async e=>await I(g(e.object,e.address));function g(e,r){return"string"!=typeof e&&(e=e.object),{parent:e,key:{type:"address",value:r}}}function j(e,r){return"string"!=typeof e&&(e=e.object),{parent:e,key:{type:"0x1::string::String",value:r}}}function h(e,r){return"string"!=typeof e&&(e=e.object),{parent:e,key:{type:"u64",value:r}}}const I=async e=>{const r=await s.Protocol.Client().getDynamicFieldObject({parentId:e.parent,name:{type:e.key.type,value:e.key.value}});return P(r?.data)};function k(e){if(!e)return;const r=s.Protocol.Instance().object_name_from_type_repr(e);if("Permission"===r||"Demand"===r||"Machine"===r||"Progress"===r||"Order"===r||"Service"===r||"Treasury"===r||"Arb"===r||"Repository"===r||"Payment"===r||"Discount"===r||"Guard"===r||"Arbitration"===r)return r;if("Resource"===r)return"PersonalMark";const t=e?.indexOf("0x2::dynamic_field::Field<");if(0===t){const r=e?.substring(26);if(r&&s.Protocol.Instance().hasPackage(r)){if(r.includes("::demand::Tips>"))return"TableItem_DemandPresenter";if(r.includes("::machine::NodePair>>>"))return"TableItem_MachineNode";if(r.includes("::progress::History>"))return"TableItem_ProgressHistory";if(r.includes("::service::Sale>"))return"TableItem_ServiceSale";if(r.includes("::treasury::Record>"))return"TableItem_TreasuryHistory";if(r.includes("::arb::Voted>"))return"TableItem_ArbVote";if(r.includes("::permission::Perm>>"))return"TableItem_PermissionEntity";if(r.includes("::repository::DataKey"))return"TableItem_RepositoryData";if(r.includes("::entity::Ent>"))return"Personal";if(r.includes("::resource::Tags>"))return"TableItem_PersonalMark"}}}function P(e){const r=e?.content?.fields,t=e?.objectId??r?.id?.id??void 0,i=e?.type??e?.content?.type??void 0,a=e?.version??void 0,n=e?.owner??void 0,o=k(i);if(o)switch(o){case"Permission":return{object:t,type:o,type_raw:i,owner:n,version:a,builder:r?.builder??"",admin:r?.admin,description:r?.description??"",entity_count:parseInt(r?.table?.fields?.size),biz_permission:r?.user_define?.fields?.contents?.map((e=>({id:parseInt(e?.fields?.key),name:e?.fields?.value})))};case"Demand":return{object:t,type:o,type_raw:i,owner:n,version:a,permission:r?.permission,description:r?.description,guard:r?.guard?{object:r?.guard,service_id_in_guard:r?.service_identifier}:void 0,time_expire:r?.time_expire,yes:r?.yes,presenter_count:parseInt(r?.presenters?.fields?.size),bounty:r?.bounty?.map((e=>({type:e?.fields?.type,object:e?.fields?.id?.id,balance:e?.fields?.balance})))};case"Machine":return{object:t,type:o,type_raw:i,owner:n,version:a,permission:r?.permission??"",description:r?.description??"",bPaused:r?.bPaused,bPublished:r?.bPublished,endpoint:r?.endpoint,consensus_repository:r?.consensus_repositories,node_count:parseInt(r?.nodes?.fields?.size)};case"Progress":return{object:t,type:o,type_raw:i,owner:n,version:a,machine:r?.machine,current:r?.current,task:r?.task,parent:r?.parent,history_count:parseInt(r?.history?.fields?.contents?.fields?.size),namedOperator:r?.namedOperator?.fields?.contents?.map((e=>({name:e?.fields?.key,operator:e?.fields?.value}))),session:r?.session?.fields?.contents?.map((e=>({weights:e?.fields?.value?.fields?.weight,threshold:e?.fields?.value?.fields?.threshold,next_node:e?.fields?.key,forward:e?.fields?.value?.fields?.forwards?.fields?.contents?.map((e=>({forward_name:e?.fields?.key,accomplished:e?.fields?.value?.fields?.accomplished,msg:e?.fields?.value?.fields?.msg,orders:e?.fields?.value?.fields?.orders,time:e?.fields?.value?.fields?.time,holder:e?.fields?.value?.fields?.who})))})))};case"Order":return{object:t,type:o,type_raw:i,owner:n,version:a,service:r?.service,amount:r?.amount,agent:r?.agent,arb:r?.dispute,payer:r?.payer,progress:r?.progress,discount:r?.discount,balance:r?.payed,required_info:r?.required_info?{pubkey:r?.required_info?.fields?.customer_pub,msg_encrypted:r?.required_info?.fields?.info}:void 0,item:r?.items?.map((e=>({name:e?.fields?.name,price:e?.fields?.price,stock:e?.fields?.stock,endpoint:e?.fields?.endpoint})))};case"Service":return{object:t,type:o,type_raw:i,owner:n,version:a,machine:r?.machine,permission:r?.permission,description:r?.description,arbitration:r?.arbitrations,bPaused:r?.bPaused,bPublished:r?.bPublished,buy_guard:r?.buy_guard,endpoint:r?.endpoint,payee:r?.payee,repository:r?.repositories,withdraw_guard:r?.withdraw_guard?.fields?.contents?.map((e=>({object:e?.fields?.key,percent:e?.fields?.value}))),refund_guard:r?.refund_guard?.fields?.contents?.map((e=>({object:e?.fields?.key,percent:e?.fields?.value}))),sales_count:parseInt(r?.sales?.fields?.size),extern_withdraw_treasury:r?.extern_withdraw_treasuries,customer_required_info:r?.customer_required?{pubkey:r?.customer_required?.fields?.service_pubkey,required_info:r?.customer_required?.fields?.customer_required_info}:void 0};case"Treasury":return{object:t,type:o,type_raw:i,owner:n,version:a,permission:r?.permission,description:r?.description,withdraw_mode:r?.withdraw_mode,history_count:parseInt(r?.history?.fields?.contents?.fields?.size),balance:r?.balance,deposit_guard:r?.deposit_guard,withdraw_guard:r?.withdraw_guard?.fields?.contents?.map((e=>({object:e?.fields?.key,percent:e?.fields?.value})))};case"Arbitration":return{object:t,type:o,type_raw:i,owner:n,version:a,permission:r?.permission,description:r?.description,fee:r?.fee,fee_treasury:r?.fee_treasury,usage_guard:r?.usage_guard,endpoint:r?.endpoint,bPaused:r?.bPaused,voting_guard:r?.voting_guard?.fields?.contents?.map((e=>({object:e?.fields?.key,weights:e?.fields?.value})))};case"Arb":return{object:t,type:o,type_raw:i,owner:n,version:a,arbitration:r?.arbitration,description:r?.description,fee:r?.fee,feedback:r?.feedback,indemnity:r?.indemnity,order:r?.order,voted_count:parseInt(r?.voted?.fields?.size),proposition:r?.proposition?.fields?.contents?.map((e=>({proposition:e?.fields?.key,votes:e?.fields?.value})))};case"Repository":return{object:t,type:o,type_raw:i,owner:n,version:a,permission:r?.permission,description:r?.description,policy_mode:r?.policy_mode,data_count:parseInt(r?.data?.fields?.size),reference:r?.reference,rep_type:r?.type,policy:r?.policies?.fields?.contents?.map((e=>({key:e?.fields?.key,description:e?.fields?.value?.fields?.description,permissionIndex:e?.fields?.value?.fields?.permission_index,dataType:e?.fields?.value?.fields?.value_type})))};case"Payment":return{object:t,type:o,type_raw:i,owner:n,version:a,signer:r?.signer,time:r?.time,remark:r?.remark,from:r?.from,biz_id:r?.index,for_guard:r?.for_guard,for_object:r?.for_object,amount:r?.amount,record:r?.record?.map((e=>({recipient:e?.fields?.recipient,amount:e?.fields?.amount})))};case"Discount":return{object:t,type:o,type_raw:i,owner:n,version:a,service:r?.service,time_start:r?.time_start,time_end:r?.time_end,price_greater:r?.price_greater,off_type:r?.type,off:r?.off,name:r?.name};case"Guard":return{object:t,type:o,type_raw:i,owner:n,version:a,description:r?.description,input:Uint8Array.from(r?.input?.fields?.bytes),identifier:r?.constants?.map((e=>({id:e?.fields?.identifier,bWitness:e?.fields?.bWitness,value:Uint8Array.from(e?.fields?.value)})))};case"PersonalMark":return{object:t,type:o,type_raw:i,owner:n,version:a,tag_count:parseInt(r?.tags?.fields?.size)};case"TableItem_DemandPresenter":return{object:t,type:o,type_raw:i,owner:n,version:a,service:r?.name,presenter:r?.value?.fields?.who,recommendation:r?.value?.fields?.tips};case"TableItem_ProgressHistory":return{object:t,type:o,type_raw:i,owner:n,version:a,history:s.Progress.DeHistory(r)};case"TableItem_ServiceSale":return{object:t,type:o,type_raw:i,owner:n,version:a,item:{item:r?.name,stock:r?.value?.fields?.stock,price:r?.value?.fields?.price,endpoint:r?.value?.fields?.endpoint}};case"TableItem_TreasuryHistory":return{object:t,type:o,type_raw:i,owner:n,version:a,id:r?.name,payment:r?.value?.fields?.payment,signer:r?.value?.fields?.signer,operation:r?.value?.fields?.op,amount:r?.value?.fields?.amount,time:r?.value?.fields?.time};case"TableItem_ArbVote":return{object:t,type:o,type_raw:i,owner:n,version:a,singer:r?.name,vote:r?.value?.fields?.agrees,time:r?.value?.fields?.time,weight:r?.value?.fields?.weight};case"TableItem_PermissionEntity":return{object:t,type:o,type_raw:i,owner:n,version:a,entity:r?.name,permission:r?.value?.map((e=>({id:e?.fields.index,guard:e?.fields.guard})))};case"TableItem_RepositoryData":return{object:t,type:o,type_raw:i,owner:n,version:a,address:r?.name?.fields?.id,key:r?.name?.fields?.key,data:Uint8Array.from(r?.value)};case"Personal":const c=s.Bcs.getInstance().de_entInfo(Uint8Array.from(r?.value?.fields?.avatar));return{object:t,type:o,type_raw:i,owner:n,version:a,address:r?.name,like:r?.value?.fields?.like,dislike:r?.value?.fields?.dislike,mark_object:r?.value?.fields?.resource,lastActive_digest:e?.previousTransaction,info:{homepage:c?.homepage,name:c?.name,avatar:c?.avatar,twitter:c?.twitter,discord:c?.discord,description:c?.description}};case"TableItem_PersonalMark":return{object:t,type:o,type_raw:i,owner:n,version:a,address:r?.name,name:r?.value?.fields?.nick,tags:r?.value?.fields?.tags}}return{object:t,type:void 0,type_raw:i,owner:n,version:a}}}}]);